<script type="text/javascript">
    async function save(id, oldvalue) {
        var status;
        try {
            const result = await fetch('/admin/save-status', {
                method: "POST",
                body: JSON.stringify({id: document.getElementById('id' + id).value, status: document.getElementById('status' + id).value}),
                headers: {"Content-Type":"application/json"}
            })
            status = result.status;
        }
        catch (e) {
        }
        if (status === 201) {
            document.getElementById('result' + id).innerHTML = "Status changed: " + oldvalue + " => " + document.getElementById('status' + id).value;
        } else {
            document.getElementById('result' + id).innerHTML = "Status change failed!";
        }
        document.getElementById('status' + id).blur();
    }
</script> 

<h1>View reported issues</h1>
<br>
{{> admin-navigation}}
<br>
<div class="maincontent">
    <div class="blogs">
    <h2>Issues</h2>
    {{#if issues.length}}
        <ul>
            {{#each issues}}
                <li>
                    <h3>{{this.email}}</h3>
                    <input type="hidden" id="id{{@index}}" value={{this.id}}>
                    <label for="status">Status:</label>
                        <select name="status" id="status{{@index}}" onfocus="oldvalue = this.value" onchange="save({{@index}}, oldvalue)">
                            <option value="New" {{#if (eq this.status "New")}}selected{{/if}}>New</option>
                            <option value="In progress" {{#if (eq this.status "In progress")}}selected{{/if}}>In progress</option>
                            <option value="Done" {{#if (eq this.status "Done")}}selected{{/if}}>Done</option>
                        </select>
                        <span id="result{{@index}}" class="result"></span>
                    <p>{{this.subject}}</p>
                    <p>{{this.date}}</p>
                   <p>{{{this.contentReplace}}}</p>
                </li>
            {{/each}}
        </ul>
    {{else}}
        <p>No issues available at the moment.</p>
    {{/if}}
</div>
</div>